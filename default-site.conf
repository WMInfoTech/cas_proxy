<VirtualHost *:80>

  ServerName ${SERVER_NAME}
  ServerAdmin webmaster@localhost
  DocumentRoot /var/www/html
  SetEnvIf X-Forwarded-Proto "https" HTTPS=on

  <Location "/">
    <RequireAny>
      Require valid-user
      Require ip ${ALLOWED_IPS}
    </RequireAny>
    CASScope /
    CASRenew On
    AuthType CAS
    AuthName "CAS Authentication"
    CASAuthNHeader CAS-User
  </Location>

  ProxyRequests Off
  ProxyPreserveHost On
  ProxyPass / ${PROXY_TARGET}
  ProxyPassReverse / ${PROXY_TARGET}

  <If "-n osenv('WEBSOCKET_TARGET')">
    RewriteEngine on
    RewriteCond ${HTTP:Upgrade} websocket [NC]
    RewriteCond ${HTTP:Connection} upgrade [NC]
    RewriteRule .* "${WEBSOCKET_TARGET}/$1" [P,L]
  </If>

  CASRootProxiedAs ${CAS_PROXY_HOST}

  LogLevel debug
  ErrorLog /dev/stdout
  CustomLog /dev/stdout combined

</VirtualHost>
